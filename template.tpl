___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Visable Website Leads",
  "categories": ["CONVERSIONS", "LEAD_GENERATION"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,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"
  },
  "description": "Tag zur einfachen Implementierung des Visable Website Leads Pixel-Codes",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "leadId",
    "displayName": "Website Leads Identifikationsnummer",
    "simpleValueType": true,
    "help": "Ihre individuelle Identifikationsnummer finden Sie im Bereich \"Website Leads Einstellungen\" auf Ihrer wlw Besucherliste"
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Debug-Meldungen in der Konsole anzeigen",
    "simpleValueType": true,
    "displayName": "Debug Mode",
    "help": "Zum Testen des Pixels können die Meldungen hiermit in der Konsole angezeigt werden."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary APIs
const encodeUriComponent = require('encodeUriComponent');
const logToConsole = require('logToConsole');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');

// capture values of template fields
const account = data.leadId;

// Get the URL the user input into the text field
const url = 'https://www.visableleads.com/v1/cp/' + encodeUriComponent(account);

// If the user chose to log debug output, initialize the logging method
const log = data.debug ? logToConsole : (() => {});

log('Visable: Loading script from ' + url);

// If the script loaded successfully, log a message and signal success
const onSuccess = () => {
  log('Visable: Script loaded successfully.');
  data.gtmOnSuccess();
};

// If the script fails to load, log a message and signal failure
const onFailure = () => {
  log('Visable: Script load failed.');
  data.gtmOnFailure();
};

// If the URL input by the user matches the permissions set for the template,
// inject the script with the onSuccess and onFailure methods as callbacks.
if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure);
} else {
  log('Visable: Script load failed due to permissions mismatch.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://www.visableleads.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Pixel test
  code: |+
    // require relevant API
    const sendPixel = require('sendPixel');
    const encodeUriComponent = require('encodeUriComponent');

    // capture values of template fields
    const account = 'eecfb001f9dc0ebd9a1097f401d3684a';

    // use the provided APIs to do things like send pixels
    const url = 'https://www.visableleads.com/v1/cp/' + encodeUriComponent(account);
    sendPixel(url, data.gtmOnSuccess, data.gtmOnFailure);

setup: ''


___NOTES___

Created on 14.9.2021, 15:19:09


